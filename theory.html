
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Theory &#8212; MrfmSim-Marohn 0.1.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experiment" href="experiment.html" />
    <link rel="prev" title="Overview" href="overview.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">MrfmSim-Marohn 0.1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="readme.html">
   MrfmSim-Marohn
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Experimental Setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="component/sample.html">
   Sample
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="component/grid.html">
   Grid
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="component/magnet.html">
   Magnet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="component/cantilever.html">
   Cantilever
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Theory and Experiments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="experiment.html">
   Experiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="simulation.html">
   Trapezoid Integration
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Units
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="units.html">
   Units
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="develop.html">
   Development notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tests.html">
   Tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="license.html">
   License
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowlegements.html">
   Acknowledgements
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/theory.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polarization">
   Polarization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#steady-state-solution">
     Steady-state solution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intermittent-irradiation">
     Intermittent Irradiation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adiabatic-rapid-passage">
     Adiabatic Rapid Passage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adiabaticity">
     Adiabaticity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nutation">
     Nutation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#equilibrium-magnetization-and-variance">
   Equilibrium magnetization and Variance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equilibrium-magnetization">
     equilibrium magnetization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equilibrium-variance">
     equilibrium variance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference">
   Reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-mrfmsim_marohn.formula.polarization">
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     formula.polarization
    </span>
   </code>
   module
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Theory</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polarization">
   Polarization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#steady-state-solution">
     Steady-state solution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#intermittent-irradiation">
     Intermittent Irradiation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adiabatic-rapid-passage">
     Adiabatic Rapid Passage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adiabaticity">
     Adiabaticity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nutation">
     Nutation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#equilibrium-magnetization-and-variance">
   Equilibrium magnetization and Variance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equilibrium-magnetization">
     equilibrium magnetization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equilibrium-variance">
     equilibrium variance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference">
   Reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-mrfmsim_marohn.formula.polarization">
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     formula.polarization
    </span>
   </code>
   module
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="theory">
<h1>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">#</a></h1>
<section id="polarization">
<h2>Polarization<a class="headerlink" href="#polarization" title="Permalink to this headline">#</a></h2>
<section id="steady-state-solution">
<h3>Steady-state solution<a class="headerlink" href="#steady-state-solution" title="Permalink to this headline">#</a></h3>
<table class="autosummary longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mrfmsim_marohn.formula.polarization.rel_dpol_sat_steadystate" title="mrfmsim_marohn.formula.polarization.rel_dpol_sat_steadystate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mrfmsim_marohn.formula.polarization.rel_dpol_sat_steadystate</span></code></a>(...)</p></td>
<td><p>Relative change in polarization for steady-state.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="intermittent-irradiation">
<span id="theory-irradation-section"></span><h3>Intermittent Irradiation<a class="headerlink" href="#intermittent-irradiation" title="Permalink to this headline">#</a></h3>
<table class="autosummary longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mrfmsim_marohn.formula.polarization.rel_dpol_periodic_irrad" title="mrfmsim_marohn.formula.polarization.rel_dpol_periodic_irrad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mrfmsim_marohn.formula.polarization.rel_dpol_periodic_irrad</span></code></a>(...)</p></td>
<td><p>Relative change in polarization for intermittent irradiation.</p></td>
</tr>
</tbody>
</table>
<p>In our magnetic resonance experiment, we alternate microwave-on and
microwave-off periods. With the microwaves on, magnetization evolves towards
a saturated, steady-state value at a rate <span class="math notranslate nohighlight">\(r0\)</span>. With the microwaves
off, magnetization evolved towards equilibrium at a rate <span class="math notranslate nohighlight">\(r1 = 1/T1\)</span>.
The irradiation scheme and resulting magnetization dynamics are summarized
in the following table</p>
</section>
<section id="adiabatic-rapid-passage">
<span id="theory-arp-section"></span><h3>Adiabatic Rapid Passage<a class="headerlink" href="#adiabatic-rapid-passage" title="Permalink to this headline">#</a></h3>
<table class="autosummary longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mrfmsim_marohn.formula.polarization.rel_dpol_arp" title="mrfmsim_marohn.formula.polarization.rel_dpol_arp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mrfmsim_marohn.formula.polarization.rel_dpol_arp</span></code></a>(...)</p></td>
<td><p>Relative change in polarization for adiabatic rapid passage.</p></td>
</tr>
</tbody>
</table>
<p>The Zeeman field <span class="math notranslate nohighlight">\(B_z(\vec{r})\)</span> experienced by spins at location
<span class="math notranslate nohighlight">\(\vec{r}\)</span> is a sum of the <span class="math notranslate nohighlight">\(z\)</span> component of the tip field and the
static field, which we take to be oriented along the <span class="math notranslate nohighlight">\(z\)</span> axis,</p>
<div class="math notranslate nohighlight" id="equation-eq-bz">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-bz" title="Permalink to this equation">#</a></span>\[B_z(\vec{r}) = B_0 + B_z^{\mathrm{tip}}(\vec{r})\]</div>
<p>Here we assume that  <span class="math notranslate nohighlight">\(B_0 \gg B_z^{\mathrm{tip}}\)</span>, which requires us
to consider only the <span class="math notranslate nohighlight">\(z\)</span> component of the tip field and spin
magnetization.
The spin-dependent change in the spring constant is determined using</p>
<div class="math notranslate nohighlight" id="equation-eq-deltak">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-deltak" title="Permalink to this equation">#</a></span>\[\delta k_{\mathrm{spin}} = - \sum_j
    \delta M_z (\vec{r}_j)
    \frac{\partial^2 B_{z}^{\mathrm{tip}}({\vec{r}}_j)}{\partial z^2}
    \Delta V_j\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta M_z\)</span> is the change in magnetization density and
<span class="math notranslate nohighlight">\(\Delta V_j\)</span> is the volume of each voxel (or volume element) in the
sample. We have drawn equation <a class="reference internal" href="#equation-eq-deltak">(2)</a> (with its leading minus sign)
from reference <a class="footnote-reference brackets" href="#lee2012apra" id="id1">2</a> (equation 8). We have taken care to implement
the leading minus sign here.</p>
<p>Let us now derive the equations we will use to calculate the change in
magnetization density <span class="math notranslate nohighlight">\(\delta M_z (\vec{r})\)</span> resulting from the
adiabatic rapid passage. In a frame of reference rotating counter clockwise
about the <span class="math notranslate nohighlight">\(z\)</span> axis at frequency <span class="math notranslate nohighlight">\(\omega\)</span>, the magnetization
density evolves under the action of the effective field</p>
<div class="math notranslate nohighlight" id="equation-eq-b-eff">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-b-eff" title="Permalink to this equation">#</a></span>\[\vec{B}_{\mathrm{eff}} =
    (B_z(\vec{r}) - \frac{\omega}{\gamma}) \hat{z}
    + B_1 \hat{x}_{\mathrm{R}}\]</div>
<p>with <span class="math notranslate nohighlight">\(\hat{z}\)</span> a unit vector along <span class="math notranslate nohighlight">\(z\)</span> axis,
<span class="math notranslate nohighlight">\(\hat{x}_{\mathrm{R}}\)</span> a transverse rotating basis vector,
<span class="math notranslate nohighlight">\(B_z(\vec{r})\)</span> given by equation <a class="reference internal" href="#equation-eq-bz">(1)</a>, <span class="math notranslate nohighlight">\(\omega\)</span> the
frequency of the applied oscillating field, <span class="math notranslate nohighlight">\(\gamma\)</span> the gyromagnetic
ratio, and <span class="math notranslate nohighlight">\(2 B_1\)</span> the amplitude of the oscillating magnetic field,
assumed to be linearly polarized. We are making the rotating wave
approximation in using equation <a class="reference internal" href="#equation-eq-b-eff">(3)</a> to describe the evolution of
magnetization under linearly polarized irradiation. It is useful to write
down a unit vector parallel to the effective field:</p>
<div class="math notranslate nohighlight" id="equation-eq-beff">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-beff" title="Permalink to this equation">#</a></span>\[\vec{b}_{\mathrm{eff}} =
    \frac{B_z(\vec{r}) - \omega/\gamma}
    {\sqrt{(B_z(\vec{r}) - \omega/\gamma)^2 + B_1^2}} \hat{z}
    + \frac{B_1}
    {\sqrt{(B_z(\vec{r}) - \omega/\gamma)^2 + B_1^2}} \hat{x}_{\mathrm{R}}\]</div>
<p>Dividing both the numerators and denominators in the equation <a class="reference internal" href="#equation-eq-beff">(4)</a> by
<span class="math notranslate nohighlight">\(B_1\)</span>, this unit vector can be written as</p>
<div class="math notranslate nohighlight" id="equation-eq-beff2">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-beff2" title="Permalink to this equation">#</a></span>\[\hat{b}_{\mathrm{eff}}(\Omega) =
    \frac{\Omega}{\sqrt{\Omega^2+1}} \hat{z}
    + \frac{1}{\sqrt{\Omega^2+1}} \hat{x}_{\mathrm{R}}\]</div>
<p>with</p>
<div class="math notranslate nohighlight" id="equation-eq-omega">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-omega" title="Permalink to this equation">#</a></span>\[\Omega = \frac{\gamma B_z(\vec{r}) - \omega}{\gamma B_1}\]</div>
<p>the (unitless) ratio of the resonance offset to the Rabi frequency;
<span class="math notranslate nohighlight">\(\Omega &gt; 0\)</span> and <span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff},z} &gt; 0\)</span> for spins at
a field above the resonance field <span class="math notranslate nohighlight">\(\omega/\gamma\)</span> while
<span class="math notranslate nohighlight">\(\Omega &lt; 0\)</span> and <span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff},z} &lt; 0\)</span> for spins at
a field below the resonance field <span class="math notranslate nohighlight">\(\omega/\gamma\)</span>.</p>
<p>Now consider the evolution of sample magnetization during an adiabatic rapid
passage through resonance. The magnetization is initially along the <span class="math notranslate nohighlight">\(z\)</span>
axis. Just before time <span class="math notranslate nohighlight">\(t = 0\)</span>,</p>
<div class="math notranslate nohighlight" id="equation-eq-mz0-minus">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-mz0-minus" title="Permalink to this equation">#</a></span>\[\vec{M}(0^{-}) = M_{z}(0) \: \hat{z}\]</div>
<p>At time <span class="math notranslate nohighlight">\(t = 0\)</span> the irradiation is turned on with an initial offset
frequency of <span class="math notranslate nohighlight">\(\Omega_{\mathrm{i}}\)</span>. Since this effective field is not
quite parallel to the <span class="math notranslate nohighlight">\(z\)</span> axis in the rotating frame, the initial
magnetization vector will precess around it. The component of the initial
magnetization perpendicular to the initial effective field
<span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff}}(\Omega_{\mathrm{i}})\)</span> will quickly dephase,
within in a time <span class="math notranslate nohighlight">\(T_2 \sim 5 \: \mu\mathrm{s}\)</span>. The component of the
initial magnetization parallel to the initial effective field will survive
this dephasing.
The magnetization after this dephasing, at time <span class="math notranslate nohighlight">\(t = 0^{+}\)</span>,
is given by the projection of <span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{-})\)</span> onto
<span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff}}\)</span>,</p>
<div class="math notranslate nohighlight" id="equation-eq-mz0-plus">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-mz0-plus" title="Permalink to this equation">#</a></span>\[\vec{M}(0^{+}) =
    M_{z}(0) \left( \hat{b}_{\mathrm{eff}}(\Omega_{\mathrm{i}})
    \cdot \vec{M}_{z}(0^{-}) \right)
    \: \hat{b}_{\mathrm{eff}}(\Omega_{\mathrm{i}})\]</div>
<p>The prefactor in parenthesis may be positive or negative, depending on whether
<span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{-})\)</span> and
<span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff}}(\Omega_{\mathrm{i}})\)</span> are parallel
(<span class="math notranslate nohighlight">\(\Omega &gt;0\)</span>) or antiparallel (<span class="math notranslate nohighlight">\(\Omega &lt;0\)</span>). Substituting
equations <a class="reference internal" href="#equation-eq-beff2">(5)</a> and <a class="reference internal" href="#equation-eq-mz0-minus">(7)</a> into equation <a class="reference internal" href="#equation-eq-mz0-plus">(8)</a></p>
<div class="math notranslate nohighlight" id="equation-eq-mz0-2">
<span class="eqno">(9)<a class="headerlink" href="#equation-eq-mz0-2" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
\vec{M}(0^{+}) &amp; =
    M_{z}(0) \frac{\Omega_{\mathrm{i}}}{\sqrt{\Omega_{\mathrm{i}}^2+1}}
    \left(
        \frac{\Omega_{\mathrm{i}}}{\sqrt{\Omega_{\mathrm{i}}^2+1}} \hat{z}
        + \frac{1}{\sqrt{\Omega_{\mathrm{i}}^2+1}} \hat{x}_{\mathrm{R}}
    \right) \\
&amp; =
M_{z}(0)
    \left(
        \frac{\Omega_{\mathrm{i}}^2}{\Omega_{\mathrm{i}}^2+1} \hat{z}
        + \frac{\Omega_{\mathrm{i}}}{\Omega^2_{\mathrm{i}}+1}
        \hat{x}_{\mathrm{R}}
    \right)
\end{align}\end{split}\]</div>
<p>We can see that equation <a class="reference internal" href="#equation-eq-mz0-2">(9)</a> captures <span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{+})\)</span>
correctly for spins initially above and below resonance when the irradiation
is turned on.  For example, when <span class="math notranslate nohighlight">\(\Omega = +10\)</span>,
<span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{+}) = 0.99 \: \hat{z} + 0.01 \: \hat{x}_{\mathrm{R}}\)</span>
while when <span class="math notranslate nohighlight">\(\Omega = -10\)</span>,
<span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{+}) = 0.99 \: \hat{z} - 0.01\: \hat{x}_{\mathrm{R}}\)</span>.
In both cases, <span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{+})\)</span> points
up as it should. The magnitude of <span class="math notranslate nohighlight">\(\vec{M}_{z}(0^{+})\)</span> is</p>
<div class="math notranslate nohighlight" id="equation-eq-absmz0">
<span class="eqno">(10)<a class="headerlink" href="#equation-eq-absmz0" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
\| \vec{M}(0^{+}) \|
&amp; = M_{z}(0)
\left(
    \frac{\Omega_{\mathrm{i}}^4}{(\Omega_{\mathrm{i}}^2+1)^2}
    + \frac{\Omega_{\mathrm{i}}^2}{(\Omega_{\mathrm{i}}^2+1)^2}
\right)^{1/2} \\
&amp; = M_{z}(0)
\left(
    \frac{\Omega_{\mathrm{i}}^2 (\Omega_{\mathrm{i}}^2 + 1) }
    {(\Omega_{\mathrm{i}}^2+1)^2}
\right)^{1/2} \\
&amp; = M_{z}(0)
\frac{\| \Omega_{\mathrm{i}} \|}{\sqrt{\Omega_{\mathrm{i}}^2 + 1}}
\end{align}\end{split}\]</div>
<p>At a time just <em>after</em> <span class="math notranslate nohighlight">\(t = 0^+\)</span>, the adiabatic rapid passage is
initiated and <span class="math notranslate nohighlight">\(\Omega\)</span> is swept from the initial offset
<span class="math notranslate nohighlight">\(\Omega_{\mathrm{i}}\)</span> to a final offset <span class="math notranslate nohighlight">\(\Omega_{\mathrm{f}}\)</span>. At
the end of the sweep, at time <span class="math notranslate nohighlight">\(t_{\mathrm{f}}\)</span>, the magnetization
density vector will have the same magnitude as it did at time
<span class="math notranslate nohighlight">\(t = 0^+\)</span>,
but will be oriented parallel or antiparallel to the final effective field,
<span class="math notranslate nohighlight">\(\hat{b}_{\mathrm{eff}}(\Omega_{\mathrm{f}})\)</span>,</p>
<div class="math notranslate nohighlight" id="equation-eq-vecmtf">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq-vecmtf" title="Permalink to this equation">#</a></span>\[\vec{M}(t_{\mathrm{f}}) =
\| \vec{M}_{z}(0^{+}) \| \: \mathrm{sign}(\Omega_{\mathrm{i}})
\left(
    \frac{\Omega_{\mathrm{f}}}{\sqrt{\Omega_{\mathrm{f}}^2+1}} \hat{z}
    + \frac{1}{\sqrt{\Omega_{\mathrm{f}}^2+1}} \hat{x}_{\mathrm{R}}
\right)\]</div>
<p>Here <span class="math notranslate nohighlight">\(\mathrm{sign}(\Omega_{\mathrm{i}})\)</span> accounts for the final
magnetization being parallel (for positive initial offset,
<span class="math notranslate nohighlight">\(\mathrm{sign}(\Omega_{\mathrm{i}}) = +1\)</span>) or antiparallel (for
negative initial offset, <span class="math notranslate nohighlight">\(\mathrm{sign}(\Omega_{\mathrm{i}}) = -1\)</span>) to
the final effective field. We are interested in the <span class="math notranslate nohighlight">\(z\)</span>-component of
the final magnetic field vector. Substituting  equation <a class="reference internal" href="#equation-eq-absmz0">(10)</a>
into equation <a class="reference internal" href="#equation-eq-vecmtf">(11)</a> and using</p>
<div class="math notranslate nohighlight">
\[\mathrm{sign}(\Omega_{\mathrm{i}}) \: \|
\Omega_{\mathrm{i}} \| = \Omega_{\mathrm{i}}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-mzf">
<span class="eqno">(12)<a class="headerlink" href="#equation-eq-mzf" title="Permalink to this equation">#</a></span>\[M_{z}(t_{\mathrm{f}})
=  M_{z}(0)
    \dfrac{\Omega_{\mathrm{i}}}{\sqrt{\Omega_{\mathrm{i}}^2+1}}
    \dfrac{\Omega_{\mathrm{f}}}{\sqrt{\Omega_{\mathrm{f}}^2+1}}\]</div>
<p>At each point in the sample, the change, final minus initial, in <span class="math notranslate nohighlight">\(z\)</span>
component of magnetization following the adiabatic rapid passage is given by</p>
<div class="math notranslate nohighlight" id="equation-eq-deltamz">
<span class="eqno">(13)<a class="headerlink" href="#equation-eq-deltamz" title="Permalink to this equation">#</a></span>\[\delta M_{z} = M_{z}(t_{\mathrm{f}}) - M_{z}(0)
=  M_{z}(0)
\left(
    \dfrac{\Omega_{\mathrm{i}}}{\sqrt{\Omega_{\mathrm{i}}^2+1}}
    \dfrac{\Omega_{\mathrm{f}}}{\sqrt{\Omega_{\mathrm{f}}^2+1}}
    -1
\right)\]</div>
<p>If we sweep from <span class="math notranslate nohighlight">\(\Omega_{\mathrm{i}} \rightarrow +\infty\)</span> (way above
resonance) to <span class="math notranslate nohighlight">\(\Omega_{\mathrm{f}} \rightarrow -\infty\)</span> (way below
resonance), then <span class="math notranslate nohighlight">\(\delta M_{z} = -2 M_{z}(0)\)</span>. This is what we expect
to see. For a swept-field or swept-tip experiment,</p>
<div class="math notranslate nohighlight" id="equation-eq-omegas1">
<span class="eqno">(14)<a class="headerlink" href="#equation-eq-omegas1" title="Permalink to this equation">#</a></span>\[\Omega_{\mathrm{i}} =
\frac{B_z(\vec{r}_{\mathrm{i}}) - \omega/\gamma}{B_1}
\: \: \: \mathrm{and} \: \: \:
\Omega_{\mathrm{f}} =
\frac{B_z(\vec{r}_{\mathrm{f}}) - \omega/\gamma}{B_1}\]</div>
<p>while for a swept-frequency experiment,</p>
<div class="math notranslate nohighlight" id="equation-eq-omegas2">
<span class="eqno">(15)<a class="headerlink" href="#equation-eq-omegas2" title="Permalink to this equation">#</a></span>\[\Omega_{\mathrm{i}} =
\frac{B_z(\vec{r}) - \omega_{\mathrm{i}}/\gamma}{B_1}
\: \: \: \mathrm{and} \: \: \:
\Omega_{\mathrm{f}} =
\frac{B_z(\vec{r}) - \omega_{\mathrm{f}}/\gamma}{B_1}\]</div>
<p>To compute the change in magnetization contributing to signal at each
position, we will use the equation <a class="reference internal" href="#equation-eq-deltamz">(13)</a> and either equation
<a class="reference internal" href="#equation-eq-omegas1">(14)</a> (for a swept-tip experiment) or equation <a class="reference internal" href="#equation-eq-omegas2">(15)</a>
(for a swept-frequency experiment). In the swept-frequency calculation we
need to compute the field at each point. In the swept-tip calculation, we
need to compute at each position <span class="math notranslate nohighlight">\(\vec{r}\)</span> in the sample the <span class="math notranslate nohighlight">\(z\)</span>
component of the magnetic field <em>only</em> at the beginning
(<span class="math notranslate nohighlight">\(\vec{r} = \vec{r}_{\mathrm{i}}\)</span>) and end
(<span class="math notranslate nohighlight">\(\vec{r} = \vec{r}_{\mathrm{f}}\)</span>) of the tip sweep.</p>
</section>
<section id="adiabaticity">
<h3>Adiabaticity<a class="headerlink" href="#adiabaticity" title="Permalink to this headline">#</a></h3>
<p>We would also like to assess the adiabaticity of the sweep.  With</p>
<div class="math notranslate nohighlight">
\[M_{z}(t) = M_{z}(0) \: \cos{(\theta(t))},\]</div>
<p>the adiabaticity parameter is defined generally as</p>
<div class="math notranslate nohighlight">
\[\alpha = \frac{\dot{\theta}}{\gamma B_1}.\]</div>
<p>In a cryogenic ESR-MRFM observing <span class="math notranslate nohighlight">\(\mathrm{E}^{\prime}\)</span> centers in
quartz <em>via</em> cyclic adiabatic inversion, Wago and coworkers observed a peaking
of signal when <span class="math notranslate nohighlight">\(\alpha \sim 0.1\)</span> (note that they define the adiabaticity
parameter as <span class="math notranslate nohighlight">\(1/\alpha\)</span>) <a class="footnote-reference brackets" href="#wago1998jan" id="id2">3</a>. In a room temperature NMR-MRFM
experiment observing proton magnetization in an ammonium nitrate crystal <em>via</em>
cyclic adiabatic inversion and force detection, Klein and coworkers observed
lossless inversion of magnetization when
<span class="math notranslate nohighlight">\(\alpha \leq 0.1\)</span> <a class="footnote-reference brackets" href="#klein2000aug" id="id3">1</a>.
In both of these experiments, a linear frequency sweep was used. We note
that more efficient sweeps have been devised. <a class="footnote-reference brackets" href="#baum1985dec" id="id4">4</a> <a class="footnote-reference brackets" href="#kupce1996feb" id="id5">5</a>
For a linear sweep, the adiabaticity parameter is <em>largest</em> near resonance,
where</p>
<div class="math notranslate nohighlight">
\[\alpha_{\mathrm{res}}
    = \frac{1}{\gamma B_1^2} \frac{d B_{\mathrm{eff}}}{d t}
    = \frac{1}{\omega_1} \frac{d \Omega}{d t}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\Omega\)</span> is given by equation <a class="reference internal" href="#equation-eq-omega">(6)</a> and <span class="math notranslate nohighlight">\(\omega_1 =
\gamma B_1\)</span> is the Rabi frequency.  In a swept-tip experiment, the field at
position <span class="math notranslate nohighlight">\(\vec{r}\)</span> changes by an amount <span class="math notranslate nohighlight">\(\delta B =
B_{z}^{\mathrm{tip}}(\vec{r}_{\mathrm{f}}) - B_
{z}^{\mathrm{tip}}(\vec{r}_{\mathrm{i}})\)</span> in a time equal to half of a
cantilever period, <span class="math notranslate nohighlight">\(\delta t = 1/(2 f_c)\)</span>.  If we approximate the sweep
as linear, then the adiabaticity parameter is given by</p>
<div class="math notranslate nohighlight" id="equation-eq-alpha-swept-tip">
<span class="eqno">(16)<a class="headerlink" href="#equation-eq-alpha-swept-tip" title="Permalink to this equation">#</a></span>\[\alpha_{\mathrm{res}}(\vec{r})
    \approx \frac{1}{\gamma B_1^2} \frac{\delta B}{\delta t}
= \frac{2 f_c}{\gamma B_1^2}
\| B_{z}^{\mathrm{tip}}(\vec{r}_{\mathrm{f}}) -
B_{z}^{\mathrm{tip}}(\vec{r}_{\mathrm{i}}) \|\]</div>
<p>We have introduced an absolute value sign to guarantee that <span class="math notranslate nohighlight">\(\alpha\)</span> is
positive and independent of the sweep direction. We write :math:`
alpha_{mathrm{res}}(vec{r})` to emphasize that the adiabaticity parameter
should be evaluated at each position <span class="math notranslate nohighlight">\(\vec{r}\)</span> in the sample. Equation
<a class="reference internal" href="#equation-eq-alpha-swept-tip">(16)</a> is only strictly valid at resonance and, moreover,
does not account for the sinusoidal time dependence of <span class="math notranslate nohighlight">\(\vec{r}(t)\)</span>
during the cantilever motion. Nevertheless, we will use it to access the
adiabaticity of the spin inversion in the swept-tip experiment. Since :math:`
alpha` is smaller for sample spins that do not pass through resonance,
equation <a class="reference internal" href="#equation-eq-alpha-swept-tip">(16)</a> provides an upper-bound estimate for the
adiabaticity parameter at any location. The spins which contribute most to
the signal are those which pass through resonance; for these spins, equation :eq:`
Eq:alpha-swept-tip` should be reasonably accurate.</p>
<p>In the swept-frequency experiment, the irradiation frequency is ramped from
<span class="math notranslate nohighlight">\(\omega_{\mathrm{i}}\)</span> to <span class="math notranslate nohighlight">\(\omega_{\mathrm{f}}\)</span> in a time :math:`
Delta T_{mathrm{sweep}}`; the period of the sweep <span class="math notranslate nohighlight">\(\Delta T_
{\mathrm{sweep}}\)</span> is not restricted to be half a cantilever period. The
adiabaticity parameter is independent of position <span class="math notranslate nohighlight">\(\vec{r}\)</span> and,
assuming a linear frequency sweep, equal to</p>
<div class="math notranslate nohighlight" id="equation-eq-alpha-swept-freq">
<span class="eqno">(17)<a class="headerlink" href="#equation-eq-alpha-swept-freq" title="Permalink to this equation">#</a></span>\[\alpha_{\mathrm{res}} =
    \frac{1}{\gamma^2 B_1^2}
    \frac{\| \omega_{\mathrm{f}} - \omega_{\mathrm{i}} \|}
    {\Delta T_{\mathrm{sweep}}}\]</div>
<p>As with equation <a class="reference internal" href="#equation-eq-alpha-swept-tip">(16)</a>, equation  <a class="reference internal" href="#equation-eq-alpha-swept-freq">(17)</a>
is only strictly valid for spins that pass through resonance.  Spins far away
from the resonant slice will experience an <span class="math notranslate nohighlight">\(\alpha\)</span> even smaller and
<span class="math notranslate nohighlight">\(\alpha_{\mathrm{res}}\)</span>.  We can therefore regard equation :eq:`
Eq:alpha-swept-freq` as an upper bound for the adiabaticity parameter
experienced by any spin in the sample.</p>
</section>
<section id="nutation">
<span id="theory-nutation-section"></span><h3>Nutation<a class="headerlink" href="#nutation" title="Permalink to this headline">#</a></h3>
<table class="autosummary longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#mrfmsim_marohn.formula.polarization.rel_dpol_nut" title="mrfmsim_marohn.formula.polarization.rel_dpol_nut"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mrfmsim_marohn.formula.polarization.rel_dpol_nut</span></code></a>(...)</p></td>
<td><p>Relative change in polarization under the evolution of irradiation.</p></td>
</tr>
</tbody>
</table>
<p>If the rf is turned on suddenly at <span class="math notranslate nohighlight">\(t =0\)</span>, the magnetization will nutate
around the effective field.  Neglecting relaxation, the magnetization vector a
time <span class="math notranslate nohighlight">\(t_{\mathrm{p}}\)</span> after the start of the rf pulse is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\frac{\vec{M}(t_p)}{M_{z}(0)} =
    &amp; \left(
        \frac{\Omega}{\Omega^2+1} - \frac{\Omega}{\Omega^2+1}
        \cos{(\Omega_1 t_p \sqrt{\Omega^2+1} \: )}
    \right) \hat{x}_{\mathrm{R}} \\
    &amp; - \left(
        \frac{1}{\Omega^2+1} \sin{(\Omega_1 t_p \sqrt{\Omega^2+1} \: )}
    \right) \hat{y}_{\mathrm{R}} \\
    &amp; + \left(
        \frac{\Omega^2}{\Omega^2+1}
        + \frac{1}{\Omega^2+1} \cos{(\Omega_1 t_p \sqrt{\Omega^2+1} \: )}
    \right) \hat{z}
\end{align}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(\Omega\)</span>, the unitless resonance offset, given by Eq. <a class="reference internal" href="#equation-eq-omega">(6)</a>
.  Since we observe the <span class="math notranslate nohighlight">\(z\)</span> component of magnetization, we are
interested in:</p>
<div class="math notranslate nohighlight">
\[\rho_{\mathrm{rel}}
    = \frac{M_z}{M_z(0)}
    = \frac{\Omega^2}{\Omega^2+1}
        + \frac{1}{\Omega^2+1} \cos{(\Omega_1 t_p \sqrt{\Omega^2+1} \: )}\]</div>
<p>The change in the <span class="math notranslate nohighlight">\(z\)</span> component of the magnetization due to the pulse
is, after some simplification,</p>
<div class="math notranslate nohighlight" id="equation-eq-deltamz-pulse">
<span class="eqno">(18)<a class="headerlink" href="#equation-eq-deltamz-pulse" title="Permalink to this equation">#</a></span>\[\delta M_{z}(\theta, \Omega) = M_{z}(t_{\mathrm{p}}) - M_{z}(0)
=  - 2 \, M_{z}(0) \frac{1}{\Omega^2+1}
    \sin^2{\left( \frac{\theta_p}{2} \sqrt{\Omega^2 + 1} \: \right)}\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta_p \equiv \omega_1 t_p\)</span> is the pulse angle. Plotting this
function, we see that the biggest change in magnetization, <span class="math notranslate nohighlight">\(\delta
M_{z}(\theta_p,\Omega)/M_{z}(0) = -2\)</span>, occurs on resonance (<span class="math notranslate nohighlight">\(\Omega = 0\)</span>
) when the pulse angle is set to <span class="math notranslate nohighlight">\(\theta_p = \pi\)</span>.  When <span class="math notranslate nohighlight">\(\theta_p
= \pi\)</span>, the full width at half max (FWHM) of the <span class="math notranslate nohighlight">\(\delta M_
{z}(\pi,\Omega)/M_{z}(0)\)</span> function is approximately <span class="math notranslate nohighlight">\(1.597 \Omega\)</span>. In
other words, a <span class="math notranslate nohighlight">\(\pi\)</span> pulse will invert magnetization over a resonant
slice of whose width, in field units, is approximately <span class="math notranslate nohighlight">\(1.597 \: B_1\)</span>.</p>
</section>
</section>
<section id="equilibrium-magnetization-and-variance">
<h2>Equilibrium magnetization and Variance<a class="headerlink" href="#equilibrium-magnetization-and-variance" title="Permalink to this headline">#</a></h2>
<section id="equilibrium-magnetization">
<h3>equilibrium magnetization<a class="headerlink" href="#equilibrium-magnetization" title="Permalink to this headline">#</a></h3>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">formula.magnetization.mz_eq()</span></code>: equilibrium magnetization per
spin <a class="footnote-reference brackets" href="#brill" id="id6">6</a></p>
<p>From the sample properties, we compute the magnetic moment
<span class="math notranslate nohighlight">\(\mu\)</span> of the state with the largest <span class="math notranslate nohighlight">\(m_J\)</span> quantum number,</p>
<div class="math notranslate nohighlight">
\[\mu = \hbar\gamma J [\mathrm{aN}\:\mathrm{nm}\:\mathrm{mT}^{-1}]\]</div>
<p>We calculate the ratio of the energy level splitting of spin states to
the thermal energy,</p>
<div class="math notranslate nohighlight">
\[x = \dfrac{\mu B_0}{k_b T} \: [\mathrm{unitless}],\]</div>
<p>and define the following two unitless numbers:</p>
<div class="math notranslate nohighlight">
\[\begin{split}a &amp;= \dfrac{2 \: J + 1}{2 \: J} \\
b &amp;= \dfrac{1}{2 \: J}\end{split}\]</div>
<p>In terms of these intermediate quantities, the thermal-equilibrium
polarization is given by</p>
<div class="math notranslate nohighlight">
\[p_{\text{eq}} = a \coth{(a x)} - b \coth{(b x)}
    \: [\mathrm{unitless}].\]</div>
<p>The equilibrium magnetization is given by</p>
<div class="math notranslate nohighlight">
\[\mu_z^{\text{eq}} = p_{\text{eq}} \: \mu \:
    [\mathrm{aN} \: \mathrm{nm} \: \mathrm{mT}^{-1}].\]</div>
<p>In the limit of low field or high temperature,
the equilibrium magnetization
tends towards the Curie-Weiss law,</p>
<div class="math notranslate nohighlight">
\[mu_z^{\text{eq}}
\approx \dfrac{\hbar^2 \gamma^2 \: J (J + 1)}{3 \: k_b T} B_0\]</div>
</section>
<section id="equilibrium-variance">
<h3>equilibrium variance<a class="headerlink" href="#equilibrium-variance" title="Permalink to this headline">#</a></h3>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">formula.magnetization.mz2_eq()</span></code>: magnetization variance per
spin, magnetization variance density <a class="footnote-reference brackets" href="#xue2011nov" id="id7">7</a></p>
<p>Compute the magnetization variance per spin and the magnetization
variance density for spins fluctuating at thermal equilibrium.</p>
<p>Mz2_eq: magnetization variance per spin [aN^2 nm^2/mT^2] times
gradient</p>
<p>The variance in a single spin’s magnetization in the low-polarization
limit is given by <a class="footnote-reference brackets" href="#xue2011nov" id="id8">7</a></p>
<div class="math notranslate nohighlight">
\[\sigma_{{\cal M}_{z}}^{2} = \hbar^2
\gamma^2 \dfrac{J \: (J + 1)}{3}\]</div>
<p>The magnetization variance density is obtained from
<span class="math notranslate nohighlight">\(\sigma_{{\cal M}_{z}}^{2}\)</span> by multiplying by the sample’s spin
density <span class="math notranslate nohighlight">\(\rho\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We assume for simplicity that the root mean square
polarization fluctuations are much larger than the equilibrium
polarization.  In this limit the polarization fluctuations are
independent of applied field <span class="math notranslate nohighlight">\(B_0\)</span> and temperature <span class="math notranslate nohighlight">\(T\)</span>.
This approximation will <em>not</em> be valid for <span class="math notranslate nohighlight">\(p \sim 1\)</span>
electrons.</p>
</div>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">#</a></h2>
<dl class="footnote brackets">
<dt class="label" id="klein2000aug"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p>Klein, O.; Naletov, V. &amp; Alloul, H. “Mechanical Detection
of Nuclear Spin Relaxation in a Micron-size Crystal”, <em>Eur. Phys. J. B</em>,
<strong>2000</strong>, <em>17</em>, 57 - 68
[<a class="reference external" href="http://dx.doi.org/10.1007/s100510070160">10.1007/s100510070160</a>].</p>
</dd>
<dt class="label" id="lee2012apra"><span class="brackets"><a class="fn-backref" href="#id1">2</a></span></dt>
<dd><p>Lee, S.-G.; Moore, E. W. &amp; Marohn, J. A. “A Unified Picture
of Cantilever Frequency-Shift Measurements of Magnetic Resonance”,
<em>Phys. Rev. B</em>, <strong>2012</strong>, <em>85</em>, 165447
[<a class="reference external" href="http://dx.doi.org/10.1103/PhysRevB.85.165447">10.1103/PhysRevB.85.165447</a>].</p>
</dd>
<dt class="label" id="wago1998jan"><span class="brackets"><a class="fn-backref" href="#id2">3</a></span></dt>
<dd><p>Wago, K.; Botkin, D.; Yannoni, C. &amp; Rugar, D.
“Force-detected Electron-spin Resonance: Adiabatic Inversion, Nutation,
and Spin Echo”, <em>Phys. Rev. B</em>, <strong>1998</strong>, <em>57</em>, 1108 - 1114
[<a class="reference external" href="http://doi.org/10.1103/PhysRevB.57.1108">10.1103/PhysRevB.57.1108</a>].</p>
</dd>
<dt class="label" id="baum1985dec"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>Baum, J.; Tycko, R. &amp; Pines, A. “Broadband and Adiabatic
Inversion of a Two-level System by Phase-modulated Pulses”, <em>Phys. Rev. A</em>
, <strong>1985</strong>, <em>32</em>, 3435 - 3447
[<a class="reference external" href="http://dx.doi.org/10.1103/PhysRevA.32.3435">10.1103/PhysRevA.32.3435</a>].</p>
</dd>
<dt class="label" id="kupce1996feb"><span class="brackets"><a class="fn-backref" href="#id5">5</a></span></dt>
<dd><p>Kupce, E. &amp; Freeman, R. “Optimized Adiabatic Pulses for
Wideband Spin Inversion”, <em>Journal of Magnetic Resonance, Series A</em>,
<strong>1996</strong>, <em>118</em>, 299 - 303
[<a class="reference external" href="http://dx.doi.org/10.1006/jmra.1996.0042">10.1006/jmra.1996.0042</a>].</p>
</dd>
<dt class="label" id="brill"><span class="brackets"><a class="fn-backref" href="#id6">6</a></span></dt>
<dd><p><a class="reference external" href="http://en.wikipedia.org/wiki/Brillouin_and_Langevin_functions">“Brillouin and Langevin functions”</a></p>
</dd>
<dt class="label" id="xue2011nov"><span class="brackets">7</span><span class="fn-backref">(<a href="#id7">1</a>,<a href="#id8">2</a>)</span></dt>
<dd><p>Equations 1 and 2 in Xue, F.; Weber, D.; Peddibhotla, P. &amp;
Poggio, M. “Measurement of statistical nuclear spin polarization in a
nanoscale GaAs samples”, <em>Phys. Rev. B</em>, <strong>2011</strong>, <em>84</em>, 205328
[<a class="reference external" href="http://dx.doi.org/10.1103/PhysRevB.84.205328">10.1103/PhysRevB.84.205328</a>].</p>
</dd>
</dl>
</section>
<section id="module-mrfmsim_marohn.formula.polarization">
<span id="formula-polarization-module"></span><h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">formula.polarization</span></code> module<a class="headerlink" href="#module-mrfmsim_marohn.formula.polarization" title="Permalink to this headline">#</a></h2>
<p>Collection of calculations of relative changes in polarization.</p>
<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_arp">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_arp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_fm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_arp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_arp" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization for adiabatic rapid passage.</p>
<p>Compute the resonance offset at each point in the sample and compute
the change in the polarization at each point in the sample following the
adiabatic rapid passage. The experiment here is a swept-field experiment
or a swept-tip experiment, where</p>
<div class="math notranslate nohighlight">
\[\Delta B_\text{offset} =
B_0 + B_\text{tip} - 2 \pi f_\text{rf}/\gamma\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\Omega_\text{initial} = B_0 + B_\text{tip} -
(2 \pi f_\text{rf}/\gamma - 2 \pi \Delta f_\text{FM}/\gamma)
= \Delta B_\text{offset} + 2 \pi \Delta f_\text{FM} / \gamma\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Gamma</strong> (<em>float</em>) – the gyromagnetic ratio [rad/s.mT]</p></li>
<li><p><strong>B_offset</strong> (<em>float</em>) – resonance offset field <span class="math notranslate nohighlight">\(\Delta B_{\text{offset}}\)</span> [mT]</p></li>
<li><p><strong>B_1</strong> (<em>float</em>) – amplitude <span class="math notranslate nohighlight">\(B_1\)</span> of the applied transverse field [mT]</p></li>
<li><p><strong>df_fm</strong> (<em>float</em>) – the peak-to-peak frequency modulation <span class="math notranslate nohighlight">\(\Delta f_{\text{FM}}\)</span>
of the applied transverse radio frequency magnetic field [Hz]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>relative change in polarization</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, the same shape as B_offset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_arp_ibm">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_arp_ibm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_fm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_arp_ibm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_arp_ibm" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization for IBM adiabatic rapid passage.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\eta \, (\Delta B_{\text{offset}}) = \begin{cases}
 \cos^2 \left(\dfrac{\gamma \Delta B_{\text{offset}}}
 {2 \: \Delta f_{\text{FM}}} \right) &amp; \text{for }
 \Delta B_{\text{offset}}
 \leq \pi \Delta f_{\text{FM}} / \gamma, \\
 0 &amp; \text{otherwise.} \end{cases}\end{split}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\Delta B_{\text{offset}} = B_0 - 2 \pi f_{\text{rf}} / \, \gamma
[\mathrm{mT}]\]</div>
<p>The result added in pol_arp
the negative sign for it is the signal of final - initial.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Gamma</strong> (<em>float</em>) – the gyromagnetic ratio [rad/s.mT]</p></li>
<li><p><strong>B_offset</strong> (<em>float</em>) – resonant offset
<span class="math notranslate nohighlight">\(\Delta B_{\text{offset}}\)</span> [mT]</p></li>
<li><p><strong>df_fm</strong> (<em>float</em>) – the peak-to-peak frequency modulation
<span class="math notranslate nohighlight">\(\Delta df_{\text{FM}}\)</span> of the applied transverse
radio frequency magnetic field [Hz]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>relative change in polarization</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, the same shape as B_offset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_multipulse">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_multipulse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rel_dpol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt_pulse</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_multipulse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_multipulse" title="Permalink to this definition">#</a></dt>
<dd><p>Calculate the average relative change in polarization after multiple pulses.</p>
<p>The formula ignores relaxation during pulses.
:param float dt_pulse: time between pulses</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_nut">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_nut</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_p</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_nut"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_nut" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization under the evolution of irradiation.</p>
<p>Equations:</p>
<div class="math notranslate nohighlight">
\[\rho_{\mathrm{rel}} = \frac{\Delta M_{z}}{M_{z}(0)}
= \frac{1}{\Omega^2+1}
(1 + \cos{(\Omega_1 t_p \sqrt{\Omega^2+1})})\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\Delta B_{\mathrm{offset}} = B_z(\vec{r}) - \omega/\gamma\]</div>
<p>the resonance offset field and</p>
<div class="math notranslate nohighlight">
\[\Omega_1 = \gamma B_1\]</div>
<div class="math notranslate nohighlight">
\[\Omega = \frac{\Delta B_{\mathrm{offset}}}{B_1}\]</div>
<p>the unitless resonance offset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Gamma</strong> (<em>float</em>) – the gyromagnetic ratio. [rad/s.mT]</p></li>
<li><p><strong>B_offset</strong> (<em>float</em>) – resonance offset field
<span class="math notranslate nohighlight">\(\Delta B_{\text{offset}}\)</span> [mT]</p></li>
<li><p><strong>B_1</strong> (<em>float</em>) – amplitude of the applied transverse field
<span class="math notranslate nohighlight">\(B_{\text{1}}\)</span> [mT]</p></li>
<li><p><strong>t_p</strong> (<em>float</em>) – pulse time <span class="math notranslate nohighlight">\(t_{\mathrm{p}}\)</span> [s]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>relative polarization</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, the same shape as B_offset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_nut_multi_freq_pulse">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_nut_multi_freq_pulse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_tot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_rf_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_p</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_nut_multi_freq_pulse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_nut_multi_freq_pulse" title="Permalink to this definition">#</a></dt>
<dd><p>Nutation experiments where different frequencies are applied in steps.</p>
<p>The polarization is aggregated as a product.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_periodic_irrad">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_periodic_irrad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dB_sat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dB_hom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_on</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_off</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_periodic_irrad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_periodic_irrad" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization for intermittent irradiation.</p>
<div class="math notranslate nohighlight">
\[\langle \Delta M_z \rangle = - \frac{S^2 \, M_0}{1 + S^2 + \Omega^2}
\left(\frac{1}{r_1} \frac{1}{\tau_\text{on}+\tau_\text{off}}
\frac{(1 - E_\text{on})(1 - E_\text{off})}
{1 - E_\text{on} \, E_\text{off}}
\frac{S^2}{1 + S^2 + \Omega^2} + \frac{\tau_\text{on}}
 {\tau_\text{on}+\tau_\text{off}}\right)\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dB_hom</strong> (<em>float</em>) – the homogeneous linewidth [mT]</p></li>
<li><p><strong>dB_sat</strong> (<em>float</em>) – the saturation linewidth [mT]</p></li>
<li><p><strong>B_offset</strong> (<em>float</em>) – resonant offset
<span class="math notranslate nohighlight">\(\Delta B_{\text{offset}}\)</span> [mT]</p></li>
<li><p><strong>B_1</strong> (<em>float</em>) – the amplitude
<span class="math notranslate nohighlight">\(B_1\)</span> of the applied transverse field [mT]</p></li>
<li><p><strong>t_1</strong> (<em>float</em>) – spin-lattice relaxation [s]</p></li>
<li><p><strong>t_on</strong> (<em>float</em>) – time with the microwaves on [s]</p></li>
<li><p><strong>t_off</strong> (<em>float</em>) – time with the microwaves off [s]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>relative change in polarization</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, the same shape as B_offset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_sat_steadystate">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_sat_steadystate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dB_sat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dB_hom</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_sat_steadystate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_sat_steadystate" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization for steady-state.</p>
<p>Compute and return the sample’s <em>relative</em> steady-state spin
polarization. As given by the Bloch equations,</p>
<div class="math notranslate nohighlight">
\[\Delta\rho_{\text{rel}} = \dfrac{\Delta {\cal M}_z}
{{\cal M}_{z}^{\text{eq}}} = - \dfrac{(B_1 / \Delta B_{\text{sat}})^2}
{1 + (\Delta B_{\text{offset}} / \Delta B_{\text{homog}})^2 +
    (B_1 / \Delta B_{\text{sat}})^2}\]</div>
<p>At resonance,</p>
<div class="math notranslate nohighlight">
\[\rho_{\text{rel}} = \dfrac{S}{1+S}\]</div>
<p>and the change in polarization is governed by the <em>saturation factor</em></p>
<div class="math notranslate nohighlight">
\[S = (B_1 / \Delta B_{\text{sat}})^2\]</div>
<p><span class="math notranslate nohighlight">\(\rho_{\text{rel}}\)</span> under irradiation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dB_hom</strong> (<em>float</em>) – the homogeneous linewidth
<span class="math notranslate nohighlight">\(\Delta B_{\text{homog}}\)</span> [mT]</p></li>
<li><p><strong>dB_sat</strong> (<em>float</em>) – the saturation linewidth
<span class="math notranslate nohighlight">\(\Delta B_{\text{sat}}\)</span> [mT]</p></li>
<li><p><strong>B_offset</strong> (<em>float</em>) – resonant offset
<span class="math notranslate nohighlight">\(\Delta B_{\text{offset}}\)</span> [mT]</p></li>
<li><p><strong>B_1</strong> (<em>float</em>) – the amplitude of the applied transverse field
<span class="math notranslate nohighlight">\(B_1\)</span> [mT]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>relative polarization</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, the same shape as B_offset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_sat_td">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_sat_td</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Bzx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_pts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tip_v</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_sat_td"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_sat_td" title="Permalink to this definition">#</a></dt>
<dd><p>Relative change in polarization for time-dependent saturation.</p>
<p>The result is not a steady-state solution because it ignores T1 relaxation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.polarization.rel_dpol_sat_td_smallsteps">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.polarization.</span></span><span class="sig-name descname"><span class="pre">rel_dpol_sat_td_smallsteps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_Bzx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_B_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_pts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tip_v</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/polarization.html#rel_dpol_sat_td_smallsteps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.polarization.rel_dpol_sat_td_smallsteps" title="Permalink to this definition">#</a></dt>
<dd><p>Small step approximation of the time-dependent relative change in polarization.</p>
</dd></dl>

<span class="target" id="module-mrfmsim_marohn.formula.magnetization"></span><dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.magnetization.mz2_eq">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.magnetization.</span></span><span class="sig-name descname"><span class="pre">mz2_eq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">J</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/magnetization.html#mz2_eq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.magnetization.mz2_eq" title="Permalink to this definition">#</a></dt>
<dd><p>Compute the magnetization variance per spin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma</strong> (<em>float</em>) – the gyromagnetic ratio. [rad/s.mT]</p></li>
<li><p><strong>J</strong> (<em>float</em>) – total spin angular momentum</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Mz2_eq, rhoMz_eq</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mrfmsim_marohn.formula.magnetization.mz_eq">
<span class="sig-prename descclassname"><span class="pre">mrfmsim_marohn.formula.magnetization.</span></span><span class="sig-name descname"><span class="pre">mz_eq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">B_tot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gamma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">J</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mrfmsim_marohn/formula/magnetization.html#mz_eq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mrfmsim_marohn.formula.magnetization.mz_eq" title="Permalink to this definition">#</a></dt>
<dd><p>Magnetization per spin at the thermal equilibrium using the Brillouin function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma</strong> (<em>float</em>) – the gyromagnetic ratio. [rad/s.mT]</p></li>
<li><p><strong>j</strong> (<em>float</em>) – total spin angular momentum</p></li>
<li><p><strong>temperature</strong> (<em>float</em>) – the spin temperature [K]</p></li>
<li><p><strong>spin_density</strong> (<em>float</em>) – the sample spin
density <span class="math notranslate nohighlight">\(\rho\)</span> [1/nm^3]</p></li>
<li><p><strong>b0</strong> (<em>float</em>) – the external magnetic field [mT]</p></li>
<li><p><strong>bz</strong> (<em>float</em>) – tip magnetic field in z [mT]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>equilibrium per-spin magnetization [aN.nm/mT]</p>
</dd>
</dl>
<p>The outputs are calculated from the sample properties</p>
<div class="math notranslate nohighlight">
\[\begin{split}J &amp;= \text{spin angular momentum quantum number}\:
    [\mathrm{unitless}]\\
\gamma &amp; = \text{gyromagnetic ratio} \:
[\mathrm{s}^{-1} \mathrm{mT}^{-1}] \\
B_0 &amp;= \text{applied magnetic field} \: [\mathrm{mT}] \\
T &amp;= \text{temperature} \: [\mathrm{K}] \\
\rho &amp;= \text{spin density} \: [\mathrm{nm}^{-1}]\end{split}\]</div>
<p>as follows. From the sample properties, we compute the magnetic moment
<span class="math notranslate nohighlight">\(\mu\)</span> of the state with the largest <span class="math notranslate nohighlight">\(m_J\)</span> quantum number,</p>
<div class="math notranslate nohighlight">
\[\mu = \hbar\gamma J \: [\mathrm{aN} \: \mathrm{nm} \:
\mathrm{mT}^{-1}]\]</div>
<p>We calculate the ratio of the energy level splitting of spin states to
the thermal energy,</p>
<div class="math notranslate nohighlight">
\[x = \dfrac{\mu B_0}{k_b T} \: [\mathrm{unitless}],\]</div>
<p>and define the following two unitless numbers:</p>
<div class="math notranslate nohighlight">
\[\begin{split}a &amp;= \dfrac{2 \: J + 1}{2 \: J} \\
b &amp;= \dfrac{1}{2 \: J}\end{split}\]</div>
<p>In terms of these intermediate quantities, the thermal-equilibrium
polarization is given by</p>
<div class="math notranslate nohighlight">
\[p_{\text{eq}} = a \coth{(a x)} - b \coth{(b x)}
    \: [\mathrm{unitless}].\]</div>
<p>The equilibrium magnetization is given by</p>
<div class="math notranslate nohighlight">
\[{\cal M}_{z}^{\text{eq}} =
    p_{\text{eq}} \: \mu \:
    [\mathrm{aN} \: \mathrm{nm} \: \mathrm{mT}^{-1}].\]</div>
<p>In the limit of low field or high temperature,
the equilibrium magnetization
tends towards the Curie-Weiss law,</p>
<div class="math notranslate nohighlight">
\[{\cal M}_{z}^{\text{eq}}
\approx \dfrac{\hbar^2 \gamma^2 \: J (J + 1)}{3 \: k_b T} B_0\]</div>
</dd></dl>

</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="overview.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Overview</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="experiment.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Experiment</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Peter Sun, John A. Marohn, Corinne Isaac<br/>
  
      &copy; Copyright 2023, Peter Sun, John A. Marohn.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>